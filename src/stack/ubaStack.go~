package stack

import (
	"log"

	"datatypes"
)

type ElemType datatypes.Slot

type Stack struct {
	elems []ElemType
	next  uint32
	limit uint32
}

func newStack(initialLimit int) (*Stack) {
	S := new(Stack)
	S.elems = make([]ElemType, initialLimit)
	S.next = 0
	S.limit = initialLimit
	return S
}

func (S *Stack) Push(e ElemType) {
	if S.next == S.limit {
		S.limit *= 2
		newStack := make([]ElemType, S.limit)
		copy(newStack, S.elems)
		S.elems = newStack
	}
	S.elems[S.next] = e
	S.next++
}

func (S *Stack) Pop() ElemType {
	if S.next == 0 {
		log.Panicln("Pop from empty stack.")
	}
	S.next--
	e := S.elems[S.next]
	if S.next == S.limit / 4 {
		S.limit /= 2
		newStack := make([]ElemType, S.limit)
		copy(newStack, S.elems)
		S.elems = newStack
	}
	return e
}

func (S *Stack) IsEmpty() bool {
	return S.next != 0
}
